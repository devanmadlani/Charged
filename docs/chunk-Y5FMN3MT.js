import{b as w}from"./chunk-ZLN3YZTI.js";import{l as S}from"./chunk-JHCU2F56.js";import"./chunk-Z7KG2CFB.js";import{H as l,Ia as p,T as o,U as a,Ua as f,V as m,Va as h,ab as g,ca as s,eb as v,fb as y,qa as u,s as n,wa as d}from"./chunk-A75ZAIYH.js";import"./chunk-NH6DWOTM.js";import"./chunk-ZNCXPSUT.js";import"./chunk-5EURDHGX.js";import"./chunk-FFGWF3JI.js";import"./chunk-RGI35SJ7.js";import"./chunk-LV4DUEUL.js";import"./chunk-4U6PRYVA.js";import"./chunk-F33KLCOC.js";import"./chunk-JWIEPCRG.js";import"./chunk-C5RQ2IC2.js";import"./chunk-D4VGNZLR.js";import"./chunk-JHLW7V75.js";import"./chunk-SV7S5NYR.js";import{g as b,i as c}from"./chunk-CVT7ZQ5I.js";var I=b(w());var E=(()=>{let e=class e{constructor(){this.router=n(d),this.authService=n(S)}ngOnInit(){return c(this,null,function*(){try{let t=yield I.default.consumeCode();if(t.status==="OK"){let i=yield this.authService.loadUserFromSession();if(i){this.authService.setUser(i);let M=this.authService.userRole()==="admin"?"/admin":"/tabs/home";this.router.navigateByUrl(M)}else this.router.navigate(["/login"],{queryParams:{error:"session-invalid"}})}else this.router.navigate(["/login"],{queryParams:{error:t.status}})}catch(t){console.error("Magic link verification failed:",t),this.router.navigate(["/login"],{queryParams:{error:"invalid-link"}})}})}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=l({type:e,selectors:[["app-auth-callback"]],decls:8,vars:0,consts:[[1,"ion-padding"],["name","crescent"]],template:function(i,C){i&1&&(o(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),s(3,"Verifying Login"),a()()(),o(4,"ion-content",0),m(5,"ion-spinner",1),o(6,"p"),s(7,"Signing you in..."),a()())},dependencies:[g,f,h,v,y,u,p],encapsulation:2});let r=e;return r})();export{E as AuthVerifyPage};
